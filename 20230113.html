<script src="https://eloquentjavascript.net/2nd_edition/code/ancestry.js"></script>
<script>
  var ancestry = JSON.parse(ANCESTRY_FILE)
  function keyBy(array, property) {
    var obj = {}
    for (var i = 0; i < array.length; i++) {
      var item = array[i]
      obj[item[property]] = item
    }
    return obj
  }
  function f(a, b, c) {
    return a + b + c
  }
  f(2, 3, 4)
  f.bind(null, 2)
  function bind(f, ...fixedArgs) {
    return function (...args) {
      return f(...fixedArgs, ...args)
    }
  }
  function f(a, b, c) {
    return a + b + c
  }
  var f2 = bind(f, 3, 5)

  function flatten(ary) {
    var result = []
    ary.reduce((xxx, item, idx) => {
      if (Array.isArray(item)) {
        result = result.concat(flatten(item))
      } else {
        result = result.concat(item)
      }
    }, 2)//这个2没用改到xxx那，所以随便传即可
    return result
  }

  function randomArray(n) {
    var result = []
    for (var i = 0; i < n; i++) {
      result.push(Math.random() * n | 0)
    }
    return result
  }

  function bubbleSort(ary) {
    for (var stop = ary.length - 1; stop >= 1; stop--) {
      var over = false
      for (var i = 0; i < stop; i++) {
        if (ary[i] > ary[i + 1]) {
          over = true
          var t = ary[i + 1]
          ary[i + 1] = ary[i]
          ary[i] = t
        }
      }
      if (!true) {
        break
      }
    }
    return ary
  }

  function selectSort(ary) {
    for (var start = 0; start < ary.length - 1; start++) {
      var minIdx = start
      for (var i = start + 1; i < ary.length; i++) {
        if (ary[i] < ary[minIdx]) {
          minIdx = i
        }
      }
      var t = ary[start]
      ary[start] = ary[minIdx]
      ary[minIdx] = t
    }
    return ary
  }

  //将存储于array中的根节点在rootPos位置的二叉树转换为二叉链表形式
  function arrayToTree(array, rootPos = 0) {
    if (array[rootPos] === null) {
      return null
    }
    var root = {
      var: array[rootPos],
      left: null,
      right: null,
    }
    root.left = arrayToTree(array, rootPos * 2 + 1)
    root.right = arrayToTree(array, rootPos * 2 + 2)

    return root
  }

  function treeToArray(root, pos = 0, result = []) {
    if (root == null) {
      return
    }
    result[pos] = root.val

    treeToArray(root.left, pos * 2 + 1, result)
    treeToArray(root.right, pos * 2 + 2, result)

    return result
  }

  function condensedArrayToTree(ary) {
    if (ary.length == 0) {
      return null
    }
    var root = {
      val: ary[0],
      left: null,
      right: null,
    }
    var nodes = [root]
    for (var i = 1; i < ary.length; i++) {
      var currNode = nodes.shift()
      if (ary[i] != null) {
        var node = {
          val: ary[i],
          left: null,
          right: null
        }
        currNode.left = node
        nodes.push(node)
      }
      i++
      if (ary[i] != null) {
        var node = {
          val: ary[i],
          left: null,
          right: null
        }
        currNode.right = node
        nodes.push(node)
      }
    }
    return root
  }
  condensedArrayToTree([1, null, 2, 3, null, null, 4, null, 5])

  function treeToCondensedArray(root) {
    var ary = []
    if (!root) {
      return ary
    }
    var nodes = [root]
    while (nodes.length) {
      var node = nodes.shift()
      if (node) {
        ary.push(node.val)
        nodes.push(node.left)
        nodes.push(node.right)
      } else {
        ary.push(node)
      }
    }
    return ary
  }

  function insertSort(ary) {
    for (var i = 1; i < ary.length; i++) {
      var value = ary[i]
      for (var j = i - 1; j >= 0; j--) {
        if (ary[j] > value) {
          ary[j + 1] = ary[j]
        } else {
          break
        }
      }
      ary[j + 1] = value
    }
    return ary
  }

  function mergeSort(ary) {
    if (ary.length < 2) {
      return ary
    }

    var mid = Math.floor(ary.length / 2)
    var left = ary.slice(0, mid)
    var right = ary.slice(mid)

    mergeSort(left)
    mergeSort(right)

    var i = 0
    var j = 0
    var k = 0
    while (i < left.length && j < right.length) {
      if (left[i] < right[j]) {
        ary[k] = left[i]
        i++
        k++
      } else {
        ary[k] = right[j]
        j++
        k++
      }
    }
    while (i < left.length) {
      ary[k] = left[i]
      k++
      i++
    }
    while (j < right.length) {
      ary[k] = right[j]
      k++
      j++
    }
    return ary
  }

  function quickSort(ary) {
    if (ary.length < 2) {
      return ary.slice()
    }
    var num = ary[0]
    var left = []
    var middle = []
    var right = []
    for (let i = 0; i < ary.length; i++) {
      if (ary[i] < num) {
        left.push(ary[i])
      } else if (ary[i] > num) {
        right.push(ary[i])
      } else if (ary[i] == num) {
        middle.push(ary[i])
      }
    }

    var sortedLeft = quickSort(left)
    var sortedRight = quickSort(right)

    return sortedLeft.concat(middle, sortedRight)
  }
  function quickSort2(ary) {
    if (ary.length < 2) {
      return ary
    }
    var num = ary[0]
    var left = []
    var right = []
    var middle = []
    for (let i = 0; i < ary.length; i++) {
      if (ary[i] < num) {
        left.push(ary[i])
      } else if (ary[i] > num) {
        right.push(ary[i])
      } else if (ary[i] == num) {
        middle.push(ary[i])
      }
    }
    quickSort2(left)
    quickSort2(right)

    var i = 0
    var k = 0
    while (i < left.length) {
      ary[k] = left[i]
      k++
      i++
    }
    i = 0
    while (i < middle.length) {
      ary[k] = middle[i]
      k++
      i++
    }
    i = 0
    while (i < right.length) {
      ary[k] = right[i]
      k++
      i++
    }
    return ary
  }

  function swap(ary, i, j) {
    var t = ary[i]
    ary[i] = ary[j]
    ary[j] = t
  }
  function qSort(ary, start = 0, end = ary.length - 1) {
    if (start >= end) {
      return ary
    }
    var pivotIndex = Math.floor(Math.random() * (end - start + 1) + start)
    var pivot = ary.at(pivotIndex)
    swap(ary, pivotIndex, end)
    //排序
    var i = start, j = start
    for (; j < end; j++) {
      if (ary[j] < pivot) {
        swap(ary, i, j)
        i++
      }
    }
    swap(ary, i, j)
    qSort(ary, start, i - 1)
    qSort(ary, i + 1, end)

    return ary
  }
</script>
